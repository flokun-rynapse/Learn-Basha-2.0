<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>GHSS Koduvally - Bhasha Hub</title>
    <style>
        :root { 
            --primary: #FF4757; 
            --secondary: #2ED573; 
            --accent: #1E90FF; 
            --bg: #F1F2F6; 
            --dark: #2F3542;
        }

        /* Fixed Mobile Viewport */
        body { 
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif; 
            margin: 0; 
            background-color: var(--dark); 
            display: flex; 
            justify-content: center; 
            height: 100vh; 
            height: 100dvh; /* Adapts to mobile browser address bars */
            overflow: hidden; 
        }

        .app-shell { 
            width: 100%; 
            max-width: 414px; 
            height: 100%;
            background: var(--bg); 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 0 40px rgba(0,0,0,0.5); 
            position: relative; 
        }

        /* Navigation Bottom Bar - Always Visible */
        .bottom-nav { 
            display: flex; 
            background: #fff; 
            border-top: 2px solid #ddd; 
            height: 70px; 
            z-index: 2000; 
            flex-shrink: 0; 
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-btn { 
            flex: 1; border: none; background: none; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; font-weight: bold; color: #57606F; 
        }
        .nav-btn.active { color: var(--primary); }
        .nav-btn span { font-size: 1.5rem; }

        .view-container { 
            flex: 1; 
            overflow-y: auto; 
            display: none; 
            -webkit-overflow-scrolling: touch;
        }
        .view-container.active { display: flex; flex-direction: column; }

        /* Learn View Styles */
        header { background: white; padding: 15px; text-align: center; border-bottom: 4px solid var(--primary); flex-shrink: 0; }
        .lang-switch { display: flex; padding: 10px; gap: 10px; background: white; flex-shrink: 0; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; background: #dfe4ea; }
        .btn-ml.active { background: var(--secondary); color: white; }
        .btn-en.active { background: var(--accent); color: white; }
        #content-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 15px; }
        .card { background: white; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-bottom: 5px solid #ddd; }
        .card:active { transform: translateY(4px); border-bottom: 2px solid #ddd; }
        .letter-display { font-size: 3.5rem; font-weight: bold; color: var(--dark); display: block; }
        .word-display { font-size: 1.2rem; color: #57606F; margin-top: 5px; display: block; }
        .emoji { font-size: 2rem; display: block; margin-bottom: 5px; }
        .v-footer { background: white; padding: 15px; text-align: center; font-weight: bold; color: var(--primary); margin-top: auto; }

        /* Game View Styles */
        .g-header { background: #2980b9; color: white; padding: 15px; text-align: center; flex-shrink: 0; }
        #score { font-size: 24px; font-weight: bold; }
        .game-area { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #ecf0f1; overflow-y: auto; }
        #drop-zone { width: 95%; min-height: 60px; background: white; border: 3px dashed #bdc3c7; border-radius: 15px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 5px; margin-bottom: 20px; padding: 5px; box-sizing: border-box; }
        .letters-pool { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; padding: 15px; background: #dfe6e9; flex-shrink: 0; }
        .letter-tile { width: 45px; height: 45px; background: #3498db; color: white; border-radius: 8px; display: flex; justify-content: center; align-items: center; font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 4px #2980b9; }
        .g-submit { background: #27ae60; color: white; border: none; padding: 15px; font-size: 18px; border-radius: 30px; cursor: pointer; width: 90%; margin-bottom: 10px; font-weight: bold; flex-shrink: 0; }
        #clear-btn { background: #e67e22; }
        .g-footer { background: #34495e; color: #bdc3c7; text-align: center; padding: 10px; font-size: 14px; font-weight: bold; flex-shrink: 0; }

        /* Overlays */
        #offline-overlay, #win-screen { display: none; position: absolute; inset: 0; flex-direction: column; justify-content: center; align-items: center; z-index: 3000; text-align: center; padding: 20px; }
        #offline-overlay { background: rgba(0,0,0,0.85); color: white; }
        #win-screen { background: rgba(255,255,255,0.95); }
        .cup-img { font-size: 100px; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    </style>
</head>
<body>

<div class="app-shell">
    <div id="offline-overlay">
        <div style="font-size: 50px;">üì°</div>
        <h2>Offline</h2>
        <p>Internet required for Play Game</p>
    </div>

    <div id="view-learn" class="view-container active">
        <header><h2 style="margin:0; color:var(--primary)">üçé Lern Basha 2.0</h2></header>
        <div class="lang-switch">
            <button class="btn btn-ml active" onclick="loadContent('ml')">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
            <button class="btn btn-en" onclick="loadContent('en')">English</button>
        </div>
        <div id="content-grid"></div>
        <div class="v-footer">GHSS Koduvally (Flokun)</div>
    </div>

    <div id="view-game" class="view-container">
        <div class="g-header">
            <div>WORDS FOUND</div>
            <div id="score">0 / 10</div>
        </div>
        <div class="game-area">
            <div id="drop-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
            <button class="g-submit" onclick="checkWord()">SUBMIT WORD</button>
            <button class="g-submit" id="clear-btn" onclick="clearDropZone()">CLEAR</button>
            <p id="status-msg" style="text-align: center; font-weight: bold; min-height: 20px;"></p>
        </div>
        <div class="letters-pool" id="pool"></div>
        <div class="g-footer">GHSS Koduvally (Flokun)</div>
        
        <div id="win-screen">
            <div class="cup-img">üèÜ</div>
            <h1>CHAMPION!</h1>
            <p>You found 10 valid words!</p>
            <button class="g-submit" onclick="location.reload()" style="width: auto; padding: 15px 40px;">PLAY AGAIN</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-btn active" id="nav-l" onclick="showView('learn')"><span>üìñ</span>Learn</button>
        <button class="nav-btn" id="nav-g" onclick="showView('game')"><span>üéÆ</span>Play</button>
    </nav>
</div>

<script>
    /* --- SHARED LOGIC --- */
    function showView(view) {
        document.getElementById('view-learn').classList.toggle('active', view === 'learn');
        document.getElementById('view-game').classList.toggle('active', view === 'game');
        document.getElementById('nav-l').classList.toggle('active', view === 'learn');
        document.getElementById('nav-g').classList.toggle('active', view === 'game');
        if(view === 'game') generateLetters();
    }

    function updateOnlineStatus() {
        document.getElementById('offline-overlay').style.display = navigator.onLine ? 'none' : 'flex';
    }
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();

    /* --- LEARN CONTENT --- */
    const data = {
        ml: [
            {l:'‡¥Ö', w:'‡¥Ö‡¥Æ‡µç‡¥Æ', e:'üë©‚Äçüë¶', s:'Amma'}, {l:'‡¥Ü', w:'‡¥Ü‡¥®', e:'üêò', s:'Aana'},
            {l:'‡¥á', w:'‡¥á‡¥≤', e:'üçÉ', s:'Ila'}, {l:'‡¥à', w:'‡¥à‡¥ö‡µç‡¥ö', e:'ü™∞', s:'Eecha'},
            {l:'‡¥â', w:'‡¥â‡¥∞‡µΩ', e:'ü•£', s:'Ural'}, {l:'‡¥ä', w:'‡¥ä‡¥û‡µç‡¥û‡¥æ‡µΩ', e:'ü™ë', s:'Oonjal'},
            {l:'‡¥ã', w:'‡¥ã‡¥∑‡¥ø', e:'üßò', s:'Rishi'}, {l:'‡¥é', w:'‡¥é‡¥≤‡¥ø', e:'üê≠', s:'Eli'},
            {l:'‡¥è', w:'‡¥è‡¥£‡¥ø', e:'ü™ú', s:'Eni'}, {l:'‡¥ê', w:'‡¥ê‡¥∏‡µç', e:'üßä', s:'Ice'},
            {l:'‡¥í', w:'‡¥í‡¥ü‡µç‡¥ü‡¥ï‡¥Ç', e:'üê™', s:'Ottakam'}, {l:'‡¥ì', w:'‡¥ì‡¥®‡µç‡¥§‡µç', e:'ü¶é', s:'Oanthu'},
            {l:'‡¥î', w:'‡¥î‡¥∑‡¥ß‡¥Ç', e:'üíä', s:'Oushadham'}, {l:'‡¥Ö‡¥Ç', w:'‡¥Ö‡¥Ç‡¥¨‡µÅ‡¥ú‡¥Ç', e:'ü™∑', s:'Ambujam'},
            {l:'‡¥Ö‡¥É', w:'‡¥¶‡µÅ‡¥É‡¥ñ‡¥Ç', e:'üò¢', s:'Dukham'},
            {l:'‡¥ï', w:'‡¥ï‡¥£‡µç‡¥£‡¥æ‡¥ü‡¥ø', e:'ü™û', s:'Kannadi'}, {l:'‡¥ñ', w:'‡¥ñ‡¥°‡µç‡¥ó‡¥Ç', e:'‚öîÔ∏è', s:'Khadgam'},
            {l:'‡¥ó', w:'‡¥ó‡¥ú‡¥Ç', e:'üêò', s:'Gajam'}, {l:'‡¥ò', w:'‡¥ò‡¥ü‡¥ø‡¥ï‡¥æ‡¥∞‡¥Ç', e:'‚è∞', s:'Ghadikaram'},
            {l:'‡¥ô', w:'‡¥Æ‡¥æ‡¥ô‡µç‡¥ô', e:'ü•≠', s:'Maanga'}, {l:'‡¥ö', w:'‡¥ö‡¥ï‡µç‡¥∞', e:'üé°', s:'Chakram'},
            {l:'‡¥õ', w:'‡¥õ‡¥æ‡¥Ø', e:'‚òï', s:'Chaya'}, {l:'‡¥ú', w:'‡¥ú‡¥≤‡¥Ç', e:'üíß', s:'Jalam'},
            {l:'‡¥ù', w:'‡¥ù‡¥æ‡µª‡¥∏‡¥ø', e:'üêé', s:'Jhansi'}, {l:'‡¥û', w:'‡¥û‡¥£‡µç‡¥ü‡µç', e:'ü¶Ä', s:'Njandu'},
            {l:'‡¥ü', w:'‡¥ü‡¥Ø‡µº', e:'üõû', s:'Tire'}, {l:'‡¥†', w:'‡¥™‡¥æ‡¥†‡¥Ç', e:'üìñ', s:'Paadam'},
            {l:'‡¥°', w:'‡¥°‡¥¨‡µç‡¥¨', e:'üì¶', s:'Dabba'}, {l:'‡¥¢', w:'‡¥¢‡¥ï‡µç‡¥ï', e:'ü•Å', s:'Dhakka'},
            {l:'‡¥£', w:'‡¥™‡¥£‡¥Ç', e:'üí∞', s:'Panam'}, {l:'‡¥§', w:'‡¥§‡¥≤', e:'üë±', s:'Thala'},
            {l:'‡¥•', w:'‡¥∞‡¥•‡¥Ç', e:'üõí', s:'Ratham'}, {l:'‡¥¶', w:'‡¥¶‡¥Ø', e:'‚ù§Ô∏è', s:'Daya'},
            {l:'‡¥ß', w:'‡¥ß‡¥®‡¥Ç', e:'ü™ô', s:'Dhanam'}, {l:'‡¥®', w:'‡¥®‡¥∞‡¥ø', e:'ü¶ä', s:'Nari'},
            {l:'‡¥™', w:'‡¥™‡¥®‡µç‡¥§‡µç', e:'‚öΩ', s:'Panthu'}, {l:'‡¥´', w:'‡¥´‡¥≤‡¥Ç', e:'üçè', s:'Phalam'},
            {l:'‡¥¨', w:'‡¥¨‡¥∏‡µç', e:'üöå', s:'Bus'}, {l:'‡¥≠', w:'‡¥≠‡¥ï‡µç‡¥∑‡¥£‡¥Ç', e:'üç±', s:'Bhakshanam'},
            {l:'‡¥Æ', w:'‡¥Æ‡¥∞‡¥Ç', e:'üå≥', s:'Maram'}, {l:'‡¥Ø', w:'‡¥Ø‡¥Æ‡µÅ‡¥®', e:'üåä', s:'Yamuna'},
            {l:'‡¥∞', w:'‡¥∞‡¥µ‡¥ø', e:'‚òÄÔ∏è', s:'Ravi'}, {l:'‡¥≤', w:'‡¥≤‡¥§', e:'üåø', s:'Latha'},
            {l:'‡¥µ', w:'‡¥µ‡¥≤', e:'üï∏Ô∏è', s:'Vala'}, {l:'‡¥∂', w:'‡¥∂‡¥∞‡¥Ç', e:'üèπ', s:'Sharam'},
            {l:'‡¥∑', w:'‡¥∑‡µ∫‡¥Æ‡µÅ‡¥ñ‡¥Ç', e:'üî±', s:'Shanmukham'}, {l:'‡¥∏', w:'‡¥∏‡¥û‡µç‡¥ö‡¥ø', e:'üõçÔ∏è', s:'Sanchi'},
            {l:'‡¥π', w:'‡¥π‡¥æ‡¥∞‡¥Ç', e:'üìø', s:'Haaram'}, {l:'‡¥≥', w:'‡¥µ‡¥æ‡¥≥', e:'üó°Ô∏è', s:'Vaala'},
            {l:'‡¥¥', w:'‡¥™‡µÅ‡¥¥', e:'üõ∂', s:'Puzha'}, {l:'‡¥±', w:'‡¥Ö‡¥±', e:'üõñ', s:'Ara'}
        ],
        en: [
            {l:'A', w:'Apple', e:'üçé'}, {l:'B', w:'Ball', e:'‚öΩ'}, {l:'C', w:'Cat', e:'üê±'},
            {l:'D', w:'Dog', e:'üê∂'}, {l:'E', w:'Egg', e:'ü•ö'}, {l:'F', w:'Fish', e:'üêü'},
            {l:'G', w:'Grapes', e:'üçá'}, {l:'H', w:'Hat', e:'üé©'}, {l:'I', w:'Igloo', e:'‚ùÑÔ∏è'},
            {l:'J', w:'Jam', e:'üçì'}, {l:'K', w:'Kite', e:'ü™Å'}, {l:'L', w:'Lion', e:'ü¶Å'},
            {l:'M', w:'Monkey', e:'üêµ'}, {l:'N', w:'Nose', e:'üëÉ'}, {l:'O', w:'Orange', e:'üçä'},
            {l:'P', w:'Parrot', e:'ü¶ú'}, {l:'Q', w:'Queen', e:'üë∏'}, {l:'R', w:'Rabbit', e:'üê∞'},
            {l:'S', w:'Sun', e:'‚òÄÔ∏è'}, {l:'T', w:'Tiger', e:'üêØ'}, {l:'U', w:'Umbrella', e:'‚òÇÔ∏è'},
            {l:'V', w:'Van', e:'üöê'}, {l:'W', w:'Watch', e:'‚åö'}, {l:'X', w:'Xylophone', e:'üéπ'},
            {l:'Y', w:'Yo-yo', e:'ü™Ä'}, {l:'Z', w:'Zebra', e:'ü¶ì'}
        ]
    };

    function loadContent(lang) {
        const container = document.getElementById('content-grid');
        container.innerHTML = '';
        document.querySelector('.btn-ml').classList.toggle('active', lang === 'ml');
        document.querySelector('.btn-en').classList.toggle('active', lang === 'en');
        data[lang].forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            const speechText = lang === 'en' ? `${item.l} for ${item.w}` : item.s;
            card.onclick = () => { if(navigator.onLine) playSound(speechText, lang); else updateOnlineStatus(); };
            card.innerHTML = `<span class="emoji">${item.e}</span><span class="letter-display">${item.l}</span><span class="word-display">${item.w}</span>`;
            container.appendChild(card);
        });
    }

    function playSound(text, lang) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = lang === 'ml' ? 'ml-IN' : 'en-US';
        msg.rate = 0.7; 
        window.speechSynthesis.speak(msg);
    }

    /* --- GAME LOGIC --- */
    let gameScore = 0;
    const pool = document.getElementById('pool');
    const dropZone = document.getElementById('drop-zone');
    const msg = document.getElementById('status-msg');

    function generateLetters() {
        pool.innerHTML = '';
        const chars = "EEEEAAIIOOOOTTTNNNRRRSSSLDDUU"; 
        for(let i=0; i<12; i++) {
            let char = chars[Math.floor(Math.random() * chars.length)];
            let div = document.createElement('div');
            div.className = 'letter-tile';
            div.innerText = char;
            div.onclick = () => {
                if(div.parentElement === pool) dropZone.appendChild(div);
                else pool.appendChild(div);
            };
            pool.appendChild(div);
        }
    }

    function clearDropZone() {
        Array.from(dropZone.children).forEach(tile => pool.appendChild(tile));
        msg.innerText = "";
    }

    async function checkWord() {
        if (!navigator.onLine) { updateOnlineStatus(); return; }
        let word = Array.from(dropZone.children).map(t => t.innerText).join('').toLowerCase();
        if(word.length < 2) { msg.innerText = "Word too short!"; msg.style.color = "#e74c3c"; return; }
        
        msg.innerText = "Verifying...";
        msg.style.color = "#34495e";

        try {
            const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
            if(response.ok) {
                gameScore++;
                document.getElementById('score').innerText = `${gameScore} / 10`;
                msg.innerText = "‚úÖ '" + word.toUpperCase() + "' is valid!";
                msg.style.color = "#27ae60";
                
                // Success: Clear and reload new letters
                dropZone.innerHTML = '';
                generateLetters(); 
                
                if(gameScore >= 10) document.getElementById('win-screen').style.display = 'flex';
            } else {
                msg.innerText = "‚ùå Not a real word!";
                msg.style.color = "#e74c3c";
            }
        } catch (error) { updateOnlineStatus(); }
    }

    // Init
    loadContent('ml');
</script>
</body>
</html>
